<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Enlitens AI Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #C105F5;
            --secondary: #05F2C7;
            --success: #7CFC00;
            --warning: #FFA500;
            --error: #FF4502;
            --bg-dark: #0f0c29;
            --bg-mid: #302b63;
            --text-light: #e1e1e1;
            --text-muted: #9CA3AF;
        }
        
        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-mid), #24243e);
            color: var(--text-light);
            font-size: 16px;
        }
        
        /* Full-screen responsive container */
        .main-container {
            height: 100vh;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(193, 5, 245, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        .status-badge {
            padding: 0.5em 1em;
            background: rgba(124, 252, 0, 0.1);
            border: 1px solid var(--success);
            border-radius: 2em;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5em;
        }
        
        .status-badge::before {
            content: '‚óè';
            color: var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-shrink: 0;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            color: var(--text-muted);
        }
        
        .tab.active {
            background: rgba(193, 5, 245, 0.2);
            border-color: var(--primary);
            color: var(--text-light);
            box-shadow: 0 4px 12px rgba(193, 5, 245, 0.3);
        }
        
        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.08);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding-right: 1rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Chain of Thought Tab - Full Screen */
        .chain-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 1rem;
            padding: 2rem;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .chain-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chain-header h2 {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .auto-scroll-toggle {
            padding: 0.5rem 1rem;
            background: rgba(193, 5, 245, 0.2);
            border: 1px solid var(--primary);
            border-radius: 0.5rem;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .auto-scroll-toggle.paused {
            background: rgba(255, 165, 0, 0.2);
            border-color: var(--warning);
        }
        
        .chain-steps {
            flex: 1;
            overflow-y: auto;
            padding-right: 1rem;
        }
        
        /* Reasoning Step - MORE SPACE */
        .reasoning-step {
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--primary);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.75rem;
            animation: fadeIn 0.3s ease;
        }
        
        .reasoning-step.thinking {
            background: rgba(193, 5, 245, 0.15);
            border-left-width: 5px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(193, 5, 245, 0.3);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .reasoning-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .reasoning-icon {
            font-size: 1.75rem;
        }
        
        .reasoning-type {
            color: var(--primary);
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .reasoning-timestamp {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-left: auto;
        }
        
        .reasoning-message {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        
        .stat-card-title {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-size: 1rem;
            color: var(--text-muted);
        }
        
        .metric-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .metric-value.highlight {
            color: var(--secondary);
            font-size: 1.5rem;
        }
        
        /* Progress Bar */
        .progress-container {
            margin: 1rem 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 2rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        /* Alert Box */
        .alert-card {
            background: rgba(255, 69, 2, 0.1);
            border: 1px solid rgba(255, 69, 2, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .alert-item {
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(255, 69, 2, 0.05);
            border-radius: 0.5rem;
        }
        
        .alert-item:last-child {
            margin-bottom: 0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 1.5rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 0.5rem;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>üß† Enlitens AI Processing Dashboard</h1>
            <div class="status-badge">Active</div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('chain')">üß† Agent Reasoning</div>
            <div class="tab" onclick="switchTab('stats')">üìä System Stats</div>
            <div class="tab" onclick="switchTab('progress')">üìà Progress</div>
            <div class="tab" onclick="switchTab('alerts')">‚ö†Ô∏è Alerts (<span id="alert-count">0</span>)</div>
        </div>
        
        <!-- Chain of Thought Tab -->
        <div id="chain-tab" class="tab-content active">
            <div class="chain-container">
                <div class="chain-header">
                    <h2>Agent Chain of Thought</h2>
                    <button class="auto-scroll-toggle" onclick="toggleAutoScroll()">
                        <span id="scroll-status">üîÑ Auto-scroll ON</span>
                    </button>
                </div>
                <div class="chain-steps" id="chain-steps">
                    <p style="text-align: center; color: var(--text-muted); padding: 3rem;">
                        ‚è≥ Waiting for agent reasoning...
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">‚ö° Power</div>
                    <div class="metric-row">
                        <span class="metric-label">Total Draw</span>
                        <span class="metric-value highlight" id="power-total">-- W</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">GPU</span>
                        <span class="metric-value" id="power-gpu">-- W</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">CPU</span>
                        <span class="metric-value" id="power-cpu">-- W</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">üéÆ GPU</div>
                    <div class="metric-row">
                        <span class="metric-label">Utilization</span>
                        <span class="metric-value" id="gpu-util">--%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Memory</span>
                        <span class="metric-value" id="gpu-mem">-- GB</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Temperature</span>
                        <span class="metric-value" id="gpu-temp">--¬∞C</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">üñ•Ô∏è CPU</div>
                    <div class="metric-row">
                        <span class="metric-label">Utilization</span>
                        <span class="metric-value" id="cpu-util">--%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Memory</span>
                        <span class="metric-value" id="cpu-mem">-- GB</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Temperature</span>
                        <span class="metric-value" id="cpu-temp">--¬∞C</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">üéØ Context Curator</div>
                    <div class="metric-row">
                        <span class="metric-label">Personas</span>
                        <span class="metric-value" id="curator-personas">-- tokens</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Health Brief</span>
                        <span class="metric-value" id="curator-health">-- tokens</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Voice Guide</span>
                        <span class="metric-value" id="curator-voice">-- tokens</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total Context</span>
                        <span class="metric-value highlight" id="curator-total">-- tokens</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Tab -->
        <div id="progress-tab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">üìä Processing Progress</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
                        </div>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Completed</span>
                        <span class="metric-value" id="docs-done">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total</span>
                        <span class="metric-value" id="docs-total">344</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Current File</span>
                        <span class="metric-value" id="current-file" style="font-size: 0.875rem;">None</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Stage</span>
                        <span class="metric-value" id="current-stage">Idle</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">üìÑ Latest Document</div>
                    <div class="metric-row">
                        <span class="metric-label">ID</span>
                        <span class="metric-value" id="latest-doc" style="font-size: 0.875rem;">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Quality</span>
                        <span class="metric-value" id="latest-quality">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Confidence</span>
                        <span class="metric-value" id="latest-confidence">--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Alerts Tab -->
        <div id="alerts-tab" class="tab-content">
            <div class="alert-card">
                <div class="stat-card-title">‚ö†Ô∏è System Alerts</div>
                <div id="alert-list">
                    <p style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        ‚úÖ No alerts
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let autoScroll = true;
        
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.querySelector('.auto-scroll-toggle');
            const status = document.getElementById('scroll-status');
            
            if (autoScroll) {
                btn.classList.remove('paused');
                status.textContent = 'üîÑ Auto-scroll ON';
            } else {
                btn.classList.add('paused');
                status.textContent = '‚è∏Ô∏è Auto-scroll PAUSED';
            }
        }
        
        async function updateChainOfThought() {
            try {
                const response = await fetch('/api/chain_of_thought');
                const data = await response.json();
                const container = document.getElementById('chain-steps');
                
                if (!data.reasoning_steps || data.reasoning_steps.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 3rem;">‚è≥ Waiting for agent reasoning...</p>';
                    return;
                }

                let html = '';
                if (data.current_document) {
                    html += `<div style="padding: 1.5rem; background: rgba(193, 5, 245, 0.1); border-radius: 1rem; margin-bottom: 2rem; border: 1px solid rgba(193, 5, 245, 0.3);">
                        <strong style="color: var(--primary); font-size: 1.125rem;">üìñ Current Document:</strong> 
                        <span style="color: var(--secondary); font-size: 1rem;">${data.current_document}</span>
                    </div>`;
                }

                data.reasoning_steps.forEach(step => {
                    const typeClass = step.is_thought ? 'thinking' : '';
                    const agentLabel = step.is_thought ? `<strong>${step.type}</strong>` : step.type;
                    html += `
                        <div class="reasoning-step ${typeClass}">
                            <div class="reasoning-header">
                                <span class="reasoning-icon">${step.icon}</span>
                                <span class="reasoning-type">${agentLabel}</span>
                                <span class="reasoning-timestamp">${step.timestamp.split(' ')[1] || ''}</span>
                            </div>
                            <div class="reasoning-message">${step.message}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                
                if (autoScroll) {
                    container.scrollTop = container.scrollHeight;
                }
            } catch (error) {
                console.error('Error fetching chain of thought:', error);
            }
        }
        
        async function updateStats() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();
                
                // Power
                document.getElementById('power-total').textContent = data.power.total + ' W';
                document.getElementById('power-gpu').textContent = data.power.gpu + ' W';
                document.getElementById('power-cpu').textContent = data.power.cpu + ' W';
                
                // GPU
                document.getElementById('gpu-util').textContent = data.gpu.utilization + '%';
                document.getElementById('gpu-mem').textContent = data.gpu.memory_used + ' / ' + data.gpu.memory_total + ' GB';
                document.getElementById('gpu-temp').textContent = data.gpu.temperature + '¬∞C';
                
                // CPU
                document.getElementById('cpu-util').textContent = data.cpu.utilization + '%';
                document.getElementById('cpu-mem').textContent = data.cpu.memory_used + ' / ' + data.cpu.memory_total + ' GB';
                document.getElementById('cpu-temp').textContent = data.cpu.temperature + '¬∞C';
                
                // Progress
                document.getElementById('docs-done').textContent = data.processing.completed;
                document.getElementById('docs-total').textContent = data.processing.total;
                
                const progress = (data.processing.completed / data.processing.total * 100).toFixed(1);
                const progressFill = document.getElementById('progress-fill');
                progressFill.style.width = progress + '%';
                progressFill.textContent = progress + '%';
                
                document.getElementById('current-file').textContent = data.processing.current_file || 'None';
                document.getElementById('current-stage').textContent = data.processing.stage || 'Idle';
                
                if (data.processing.latest_doc && data.processing.latest_doc.id) {
                    document.getElementById('latest-doc').textContent = data.processing.latest_doc.id;
                    document.getElementById('latest-quality').textContent = data.processing.latest_doc.quality || '--';
                    document.getElementById('latest-confidence').textContent = data.processing.latest_doc.confidence || '--';
                }
                
                // Context Curator
                document.getElementById('curator-personas').textContent = data.context_curator.personas + ' tokens';
                document.getElementById('curator-health').textContent = data.context_curator.health + ' tokens';
                document.getElementById('curator-voice').textContent = data.context_curator.voice + ' tokens';
                document.getElementById('curator-total').textContent = data.context_curator.total + ' tokens';
                
                // Alerts
                const alertCount = data.alerts.length;
                document.getElementById('alert-count').textContent = alertCount;
                
                const alertList = document.getElementById('alert-list');
                if (alertCount > 0) {
                    let alertHtml = '';
                    data.alerts.forEach(alert => {
                        alertHtml += `<div class="alert-item">${alert}</div>`;
                    });
                    alertList.innerHTML = alertHtml;
                } else {
                    alertList.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">‚úÖ No alerts</p>';
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }
        
        // Update every 2 seconds
        setInterval(updateChainOfThought, 2000);
        setInterval(updateStats, 2000);
        
        // Initial load
        updateChainOfThought();
        updateStats();
    </script>
</body>
</html>

